<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Page</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #050505;
      color: white;
      font-family: monospace;
      font-size: 14px;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      background: #1a1a1a;
      border-radius: 5px;
      border-left: 3px solid #a855f7;
    }
    .success { color: #22d3ee; }
    .error { color: #f43f5e; }
    .warning { color: #fbbf24; }
    pre {
      background: #0a0a0a;
      padding: 10px;
      border-radius: 5px;
      overflow: auto;
      font-size: 12px;
    }
    button {
      padding: 10px 20px;
      background: #7e22ce;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
  </style>
</head>
<body>
  <h1>ğŸ” CANCRI è°ƒè¯•é¡µé¢</h1>
  
  <div class="section">
    <h2>1. é¡µé¢ä¿¡æ¯</h2>
    <p><strong>URL:</strong> <span id="url"></span></p>
    <p><strong>Pathname:</strong> <span id="pathname"></span></p>
    <p><strong>Origin:</strong> <span id="origin"></span></p>
  </div>
  
  <div class="section">
    <h2>2. DOM æ£€æŸ¥</h2>
    <p><strong>Root Element:</strong> <span id="root-check"></span></p>
    <p><strong>Root Children:</strong> <span id="root-children"></span></p>
    <p><strong>Body Children:</strong> <span id="body-children"></span></p>
  </div>
  
  <div class="section">
    <h2>3. èµ„æºæ£€æŸ¥</h2>
    <p><strong>Scripts:</strong> <span id="scripts-count"></span></p>
    <div id="scripts-list"></div>
    <p><strong>Stylesheets:</strong> <span id="styles-count"></span></p>
    <div id="styles-list"></div>
  </div>
  
  <div class="section">
    <h2>4. ç¯å¢ƒå˜é‡</h2>
    <div id="env-info"></div>
  </div>
  
  <div class="section">
    <h2>5. é”™è¯¯æ—¥å¿—</h2>
    <div id="errors-list"></div>
  </div>
  
  <div class="section">
    <h2>6. æµ‹è¯•åŠ è½½ä¸»åº”ç”¨</h2>
    <button onclick="loadApp()">åŠ è½½ä¸»åº”ç”¨</button>
    <button onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
    <div id="app-status"></div>
  </div>
  
  <script>
    const errors = [];
    
    window.addEventListener('error', (e) => {
      errors.push({
        type: 'error',
        message: e.message,
        filename: e.filename,
        lineno: e.lineno,
        colno: e.colno,
        error: e.error?.stack
      });
      updateErrors();
    });
    
    window.addEventListener('unhandledrejection', (e) => {
      errors.push({
        type: 'promise',
        reason: String(e.reason),
        stack: e.reason?.stack
      });
      updateErrors();
    });
    
    function updateErrors() {
      const el = document.getElementById('errors-list');
      if (errors.length === 0) {
        el.innerHTML = '<p class="success">âœ… æ— é”™è¯¯</p>';
      } else {
        el.innerHTML = `<p class="error">âŒ ${errors.length} ä¸ªé”™è¯¯</p><pre>${JSON.stringify(errors, null, 2)}</pre>`;
      }
    }
    
    // é¡µé¢ä¿¡æ¯
    document.getElementById('url').textContent = window.location.href;
    document.getElementById('pathname').textContent = window.location.pathname;
    document.getElementById('origin').textContent = window.location.origin;
    
    // DOM æ£€æŸ¥
    const root = document.getElementById('root');
    if (root) {
      document.getElementById('root-check').innerHTML = '<span class="success">âœ… æ‰¾åˆ°</span>';
      document.getElementById('root-children').textContent = root.children.length;
    } else {
      document.getElementById('root-check').innerHTML = '<span class="error">âŒ æœªæ‰¾åˆ°</span>';
    }
    document.getElementById('body-children').textContent = document.body.children.length;
    
    // èµ„æºæ£€æŸ¥
    const scripts = document.querySelectorAll('script[type="module"]');
    document.getElementById('scripts-count').textContent = scripts.length;
    const scriptsList = document.createElement('div');
    scripts.forEach((s, i) => {
      const div = document.createElement('div');
      div.style.marginTop = '5px';
      div.innerHTML = `${i + 1}. <code>${s.src || 'inline'}</code>`;
      scriptsList.appendChild(div);
    });
    document.getElementById('scripts-list').appendChild(scriptsList);
    
    const styles = document.querySelectorAll('link[rel="stylesheet"]');
    document.getElementById('styles-count').textContent = styles.length;
    const stylesList = document.createElement('div');
    styles.forEach((s, i) => {
      const div = document.createElement('div');
      div.style.marginTop = '5px';
      div.innerHTML = `${i + 1}. <code>${s.href}</code>`;
      stylesList.appendChild(div);
    });
    document.getElementById('styles-list').appendChild(stylesList);
    
    // ç¯å¢ƒå˜é‡ï¼ˆæ³¨æ„ï¼šåœ¨éæ¨¡å—è„šæœ¬ä¸­æ— æ³•ä½¿ç”¨ import.metaï¼‰
    try {
      const envInfo = document.createElement('pre');
      envInfo.textContent = JSON.stringify({
        note: 'ç¯å¢ƒå˜é‡åœ¨æ„å»ºæ—¶æ³¨å…¥ï¼Œè¿è¡Œæ—¶æ— æ³•ç›´æ¥è®¿é—®',
        suggestion: 'æ£€æŸ¥æ„å»ºæ—¶çš„ç¯å¢ƒå˜é‡é…ç½®',
        currentURL: window.location.href,
        basePath: window.location.pathname.split('/').slice(0, -1).join('/') || '/'
      }, null, 2);
      document.getElementById('env-info').appendChild(envInfo);
    } catch (e) {
      document.getElementById('env-info').innerHTML = `<p class="error">æ— æ³•è¯»å–ç¯å¢ƒå˜é‡: ${e.message}</p>`;
    }
    
    updateErrors();
    
    // æµ‹è¯•åŠ è½½ä¸»åº”ç”¨ï¼ˆå®šä¹‰åœ¨å…¨å±€ä½œç”¨åŸŸï¼‰
    window.loadApp = async function() {
      const statusEl = document.getElementById('app-status');
      statusEl.innerHTML = '<p class="warning">â³ æ­£åœ¨æ£€æŸ¥ä¸»åº”ç”¨...</p>';
      
      try {
        // æ£€æŸ¥ä¸»é¡µé¢æ˜¯å¦å­˜åœ¨
        const mainPageUrl = window.location.pathname.replace('/debug.html', '/index.html');
        statusEl.innerHTML = `<p>æ£€æŸ¥ä¸»é¡µé¢: <code>${mainPageUrl}</code></p>`;
        
        // å°è¯•è®¿é—®ä¸»é¡µé¢
        fetch(mainPageUrl)
          .then(res => {
            if (res.ok) {
              statusEl.innerHTML = '<p class="success">âœ… ä¸»é¡µé¢å­˜åœ¨</p><p><a href="' + mainPageUrl + '" style="color: #22d3ee;">ç‚¹å‡»è®¿é—®ä¸»é¡µé¢</a></p>';
            } else {
              statusEl.innerHTML = `<p class="error">âŒ ä¸»é¡µé¢è¿”å›çŠ¶æ€ç : ${res.status}</p>`;
            }
          })
          .catch(e => {
            statusEl.innerHTML = `<p class="error">âŒ æ— æ³•è®¿é—®ä¸»é¡µé¢: ${e.message}</p>`;
          });
        
        // æ£€æŸ¥ä¸»åº”ç”¨çš„è„šæœ¬
        const scripts = document.querySelectorAll('script[type="module"]');
        if (scripts.length > 0) {
          const mainScript = Array.from(scripts).find(s => s.src && s.src.includes('assets'));
          if (mainScript) {
            statusEl.innerHTML += `<p>æ‰¾åˆ°ä¸»è„šæœ¬: <code>${mainScript.src}</code></p>`;
            // æµ‹è¯•è„šæœ¬æ˜¯å¦å¯è®¿é—®
            fetch(mainScript.src, { method: 'HEAD' })
              .then(res => {
                if (res.ok) {
                  statusEl.innerHTML += '<p class="success">âœ… ä¸»è„šæœ¬å¯è®¿é—®</p>';
                } else {
                  statusEl.innerHTML += `<p class="error">âŒ ä¸»è„šæœ¬è¿”å›çŠ¶æ€ç : ${res.status}</p>`;
                }
              })
              .catch(e => {
                statusEl.innerHTML += `<p class="error">âŒ æ— æ³•è®¿é—®ä¸»è„šæœ¬: ${e.message}</p>`;
              });
          }
        }
      } catch (e) {
        statusEl.innerHTML = `<p class="error">âŒ æ£€æŸ¥å¤±è´¥: ${e.message}</p>`;
      }
    };
    
    // è‡ªåŠ¨æ£€æŸ¥èµ„æºåŠ è½½çŠ¶æ€
    setTimeout(() => {
      const scripts = document.querySelectorAll('script[type="module"]');
      scripts.forEach(script => {
        if (script.src) {
          fetch(script.src, { method: 'HEAD' })
            .then(res => {
              if (!res.ok) {
                console.error(`Script failed to load: ${script.src} - ${res.status}`);
              }
            })
            .catch(e => {
              console.error(`Script fetch error: ${script.src}`, e);
            });
        }
      });
    }, 1000);
  </script>
</body>
</html>

